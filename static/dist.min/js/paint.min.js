function myChat(e){this.para=e,this.backDrop=null,this.container=e.container?e.container:document.body,this.chatDom=null,this.mainContainer=[],this.tabHeader=null,this._listArr=[],this._reqFirArr=[],this.bindDataReact(),this.loadList()}function loadAnimate(e){this.dom=null,this.init(),dom.append(e,this.dom),this.dom.addEventListener("click",function(e){e.stopPropagation(),e.preventDefault()})}function loading(e){this.text=e.text?e.text:"默认",this.textDom=null,this.container=e.container?e.container:document.body,this.backDrop=null,this.initDom()}function Modal(e){this.para=e,this.modal=document.createElement("div"),this.modalHeader=document.createElement("div"),this.modalBody=document.createElement("div"),this.init(),this.modal.appendChild(this.modalHeader),this.modal.appendChild(this.modalBody),this.modal.classList.add("animated","bounceInDown"),document.body.appendChild(this.modal)}function pagePlugin(e){this.pageDom=null,this.curPage=1,this.isOverPage=!1,"object"==typeof e&&(this.totalCounts=e.totalCounts?e.totalCounts:1,this.onePageSize=e.onePageSize?e.onePageSize:1,this.totalPage=Math.ceil(this.totalCounts/this.onePageSize),this.container=e.container?e.container:document.body,this.cb=e.cb?e.cb:null),this.totalPage>1&&this.initDom()}function share(){this.container=dom.createByHTML("<div data-show=0></div>"),this.container.classList.add("iShare"),this.init(),this.bindEvent(),dom.append(document.body,this.container)}myChat.prototype.bindDataReact=function(){Object.defineProperty(this,"listArr",{enumerable:!0,configurable:!0,get:function(){return this._listArr},set:function(e){var t=this.mainContainer[0];t.innerHTML="";for(var a=[],o=0,n=e.length;o<n;o++){var i=e[o];a.push({userName:i.user_name,headUrl:"/head/"+i.head_url,email:i.email})}if(a.length>0){var s=document.createDocumentFragment();for(o=0,n=a.length;o<n;o++){i=a[o];var r=dom.createByHTML('<div class="list"><img src="'+i.headUrl+'" /><span title="'+i.userName+'">'+i.userName+"</span><i data-email = "+i.email+' class="iconfont icon-yaoqing" title = "发送游戏邀请" data-type = "invate"></i><i data-email = '+i.email+' class="iconfont icon-69" title = "删除好友" data-type = "del"></i></div>');dom.append(s,r)}dom.append(t,s)}else dom.append(t,dom.createByHTML("<span>暂无好友</span>"));this._listArr=a}}),Object.defineProperty(this,"reqFirArr",{enumerable:!0,configurable:!0,get:function(){return this._reqFirArr},set:function(e){var t=this.mainContainer[1];t.innerHTML="";for(var a=[],o=0,n=e.length;o<n;o++){var i=e[o];a.push({userName:i.user_name,headUrl:"/head/"+i.head_url,email:i.email})}if(a.length>0){var s=document.createDocumentFragment();for(o=0,n=a.length;o<n;o++){i=a[o];var r=dom.createByHTML('<div class="list"><img src="'+i.headUrl+'" /><span title="'+i.userName+'">'+i.userName+"</span><i data-email = "+i.email+' data-type = 1 title = "同意" class="iconfont icon-iconcorrect"></i><i data-email = '+i.email+' data-type = 0 title = "拒绝"  class="iconfont icon-cuowu"></i></div>');dom.append(s,r)}dom.append(t,s)}else dom.append(t,dom.createByHTML("<span>暂无好友请求</span>"));this._reqFirArr=a}})},myChat.prototype.initDom=function(){this.backDrop=dom.createByHTML('<div class="modal-backdrop fade in"></div>'),dom.append(document.body,this.backDrop),this.chatDom=dom.createByHTML('<div class="chat-container chat-in-animate"></div>');var e=dom.createByHTML('<div class="fri-list-container"></div>'),t=dom.createByHTML('<div class="fri-req-container"></div>'),a=dom.createByHTML('<div class="fri-srarch-container"><div class="list"><input type="text" placeholder="请输入对方游戏名称" /><i class="iconfont icon-chazhao" title="查找" data-type = "search"></i></div></div>');this.mainContainer.push(e),this.mainContainer.push(t),this.mainContainer.push(a),this.tabHeader=dom.createByHTML('<div class="chat-header"><div class="fri-list selected" data-type = "0">好友列表</div><div class="fri-req-list" data-type = "1">好友请求列表</div><div class="fri-search-list" data-type = "2">添加好友</div></div>');var o=dom.createByHTML('<div class="list-con"></div>');dom.append(o,e),dom.append(o,t),dom.append(o,a),dom.append(this.chatDom,this.tabHeader),dom.append(this.chatDom,o),dom.append(this.container,this.chatDom)},myChat.prototype.initEvent=function(){var e=this;this.backDrop.addEventListener("click",function(){e.hide()}),this.tabHeader.addEventListener("click",function(t){var a=t.target,o=parseInt(a.dataset.type);switch(o){case 0:e.update();break;case 1:e.loadFriendReq()}!function(t){if(e.mainContainer[t]){for(var a=0,o=e.mainContainer.length;a<o;a++)e.mainContainer[a].removeAttribute("style");e.mainContainer[t].style.order=-1}}(o),function(){for(var e=this.parentElement.children,t=0,a=e.length;t<a;t++)e[t].classList.remove("selected");this.classList.add("selected")}.call(a)}),this.mainContainer[0].addEventListener("click",function(t){var a=t.target;if("I"===a.tagName)if("invate"===a.dataset.type){var o="function"==typeof e.para.curSocket&&e.para.curSocket.call(this),n="function"==typeof e.para.roomId&&e.para.roomId.call(this);o&&o.emit("sendInvate",JSON.stringify({from:cache.get("email"),to:a.dataset.email,roomId:n,serverName:cache.get("serverName")})),new toast({text:"已发送游戏请求"})}else{var i=a.dataset.email;util.ajax({url:"/delFriend",type:"post",data:{friendEmail:i},success:function(t){var a=JSON.parse(t);200===a.status?(e.update(),new toast({text:"删除好友成功"})):new toast({text:a.errorMsg})}})}}),this.mainContainer[1].addEventListener("click",function(t){var a=t.target;"I"===a.tagName&&(1===parseInt(a.dataset.type)?util.ajax({url:"/agreeFriReq",type:"post",data:{friendUser:a.dataset.email},success:function(t){var a=JSON.parse(t);200===a.status?(e.loadFriendReq(),new toast({text:"添加成功"})):new toast({text:a.errorMsg})}}):util.ajax({url:"/rejectFriReq",type:"post",data:{friendUser:a.dataset.email},success:function(t){var a=JSON.parse(t);200===a.status?(e.loadFriendReq(),new toast({text:"拒绝成功"})):new toast({text:a.errorMsg})}}))}),this.mainContainer[2].addEventListener("click",function(t){var a=t.target;if("I"===a.tagName)if("search"===a.dataset.type){var o=dom.query("input",a.parentElement),n=o?o.value:null;""!==n&&null!==n?e.loadSearchFri(n):new toast({text:"查找条件不能为空"})}else{var i=a.dataset.friendEmail;i!==cache.get("email")?util.ajax({url:"/addFriend",type:"post",data:{friendEmail:i},success:function(e){var t=JSON.parse(e);200===t.status?new toast({text:"好友请求已发送"}):new toast({text:t.errorMsg})}}):new toast({text:"不能添加自己为好友"})}})},myChat.prototype.loadSearchFri=function(e){var t=this;util.ajax({url:"/getUserByFuzzy",type:"post",data:{fuzzyQuery:e},success:function(e){var a=JSON.parse(e);if(200===a.status||404===a.status){var o=t.mainContainer[2].children;if(o.length>1)for(var n=1,i=o.length;n<i;n++)dom.remove(o[n]),i--,n--;var s=a.data,r=[];if(s.length>0){for(n=0,i=s.length;n<i;n++){var d=s[n];r.push({userName:d.user_name,headUrl:"/head/"+d.head_url,email:d.email})}var c=document.createDocumentFragment();for(n=0,i=r.length;n<i;n++){d=r[n];var m=dom.createByHTML('<div class="list"><img src="'+d.headUrl+'" /><span title="'+d.userName+'">'+d.userName+"</span><i data-friend-email = "+d.email+' class="iconfont icon-tianjiahaoyou1" title = "添加"></i></div>');dom.append(c,m)}dom.append(t.mainContainer[2],c)}else new toast({text:"没有查找到该用户"})}else new toast({text:a.errorMsg})}})},myChat.prototype.loadList=function(){var e=this;e.initDom(),e.initEvent(),util.ajax({url:"/getFriendList",type:"get",success:function(t){var a=JSON.parse(t);200===a.status||404===a.status?e.listArr=a.data:new toast({text:a.errorMsg})}})},myChat.prototype.update=function(){var e=this;util.ajax({url:"/getFriendList",type:"get",success:function(t){var a=JSON.parse(t);200===a.status||404===a.status?e.listArr=a.data:new toast({text:a.errorMsg})}})},myChat.prototype.loadFriendReq=function(){var e=this;util.ajax({url:"/getFriendReq",type:"get",success:function(t){var a=JSON.parse(t);200===a.status||404===a.status?e.reqFirArr=a.data:new toast({text:a.errorMsg})}})},myChat.prototype.show=function(){this.update(),this.backDrop.classList.remove("hide"),this.backDrop.classList.add("show"),this.chatDom.classList.add("chat-in-animate"),this.chatDom.classList.remove("chat-out-animate")},myChat.prototype.hide=function(){this.chatDom.classList.remove("chat-in-animate"),this.chatDom.classList.add("chat-out-animate"),this.backDrop.classList.remove("show"),this.backDrop.classList.add("hide")},loadAnimate.prototype.init=function(){this.dom=dom.createByHTML('<div class="loadAnimate"><div class="load"><div class="loader">加载中...</div></div></div>')},loadAnimate.prototype.show=function(){dom.show(this.dom)},loadAnimate.prototype.hide=function(){dom.hide(this.dom)},loading.prototype.initDom=function(){this.backDrop=dom.createByHTML('<div class="modal-backdrop fade in"></div>'),dom.append(this.container,this.backDrop),this.textDom=dom.createByHTML('<div class="loading-text"></div>'),this.textDom.innerText=this.text,dom.append(this.container,this.textDom)},loading.prototype.setText=function(e){this.textDom.innerText=e},loading.prototype.show=function(){this.backDrop.classList.remove("hide"),this.backDrop.classList.add("show"),this.textDom.classList.remove("hide"),this.textDom.classList.add("show")},loading.prototype.hide=function(){this.backDrop.classList.remove("show"),this.backDrop.classList.add("hide"),this.textDom.classList.remove("show"),this.textDom.classList.add("hide")},Modal.prototype.init=function(){this.modal.classList.add("modal"),this.modalHeader.classList.add("modalHeader"),this.modalBody.classList.add("modalBody"),this.initHeader()},Modal.prototype.initHeader=function(){var e=this,t=document.createElement("i");t.classList.add("iconfont","icon-guanbi1","modalClose"),t.addEventListener("click",function(){e.modal.classList.remove("bounceInDown"),e.modal.classList.add("bounceOutDown"),e.para.destory&&setTimeout(function(){dom.remove(e.modal)},1e3),e.para.onClose&&"function"==typeof e.para.onClose&&e.para.onClose()});var a=document.createElement("span");a.classList.add("modalTitle"),a.innerText=this.para.title,this.modalHeader.appendChild(a),this.modalHeader.appendChild(t)},Modal.prototype.getBody=function(){return this.modalBody},Modal.prototype.getHeader=function(){return this.modalHeader},Modal.prototype.show=function(){this.modal.classList.remove("bounceOutDown"),this.modal.classList.add("bounceInDown")},Modal.prototype.hide=function(){this.modal.classList.remove("bounceInDown"),this.modal.classList.add("bounceOutDown")},pagePlugin.prototype.destory=function(){dom.remove(this.pageDom)},pagePlugin.prototype.initDom=function(){this.pageDom=dom.createByHTML('<ul class="pagination"></ul>');for(var e,t=this,a=0;a<this.totalPage;a++)e=dom.createByHTML("<li><span>"+(a+1)+"</span></li>"),dom.append(this.pageDom,e);dom.append(this.container,this.pageDom),this.pageDom.addEventListener("click",function(e){var a=dom.closest(e.target,"li");a&&(t.curPage=parseInt(a.innerText),t.cb(t.curPage),t.updatePage())}),this.container.offsetWidth-40<this.pageDom.offsetWidth&&(this.isOverPage=!0)},pagePlugin.prototype.updatePage=function(){if(this.totalPage>1){for(var e,t=Array.prototype.slice.call(this.pageDom.children),a=0;a<t.length;a++)"SPAN"===t[a].nodeName?(dom.remove(t[a]),t.splice(a,1),a--):(t[a].classList.remove("curPageSelect"),t[a].classList.remove("hide"));if(t[this.curPage-1].classList.add("curPageSelect"),this.isOverPage)if(this.curPage<4){for(a=5,e=t.length;a<e;a++)t[a].classList.add("hide");var o=dom.createByHTML('<span style="margin:0px 5px;">....</span>');dom.append(this.pageDom,o)}else if(this.curPage>this.totalPage-3){for(a=0,e=this.totalPage-5;a<e;a++)t[a].classList.add("hide");o=dom.createByHTML('<span style="margin:0px 5px;float: left;">....</span>');dom.prepend(this.pageDom,o)}else{for(a=0,e=t.length;a<e;a++)Math.abs(this.curPage-(a+1))>2&&t[a].classList.add("hide");var n=dom.createByHTML('<span style="margin:0px 5px;float: left;">....</span>');dom.prepend(this.pageDom,n);var i=dom.createByHTML('<span style="margin:0px 5px;float: right;">....</span>');dom.append(this.pageDom,i)}}},share.prototype.init=function(){var e=dom.createByHTML('<a href="#" class="iShare_qzone"><i class="iconfont icon-qunfengqqkongjian"></i></a>');dom.append(this.container,e);var t=dom.createByHTML('<a href="#" class="iShare_wechat"><i class="iconfont icon-weixin-copy1"></i></a>');dom.append(this.container,t);var a=dom.createByHTML('<i class="iconfont icon-tubiao212 shareBtn"></i>');dom.prepend(this.container,a)},share.prototype.bindEvent=function(){var e=this;this.container.addEventListener("click",function(){parseInt(e.container.dataset.show)?(e.container.style.right="-80px",e.container.dataset.show=0):(e.container.style.right="0px",e.container.dataset.show=1)})};var iShare_config={container:".iShare",config:{title:"iDraw",description:"iDraw画图猜词游戏平台",url:"http://39.108.120.228:3000",WXoptions:{evenType:"click",isTitleVisibility:!0,isTipVisibility:!0,tip:"iDraw画图猜词游戏平台",title:"iDraw",bgcolor:"white"}}};function simpleModal(e){this.backDrop=null,this.modalDom=null,this.modalHeader=null,this.modalBody=null,this.modalFooter=null,this.body=e.body,this.btn=e.btn,this.title=e.title?e.title:"默认标题",this.onClose=e.onClose&&"function"==typeof e.onClose?e.onClose:function(){},this.initDom(),this.initEvent()}function toast(e){this.container=e.container?e.container:document.body,this.text=e.text?e.text:"默认",this.time=e.time?e.time:3e3,this.toastDom=null,this.init(),this.destory()}function Pos(e,t){this.x=e,this.y=t}function Path(e,t,a){this.pts=e,this.lw=t||canvas.lw,this.color=a||canvas.color}function Rect(e,t,a,o){this.x=e,this.y=t,this.w=a,this.h=o}function initGallery(e){this.curImg=null,this.userDom=null,this.goodNumDom=null,this.parModal=e,this.loadAnimate=new loadAnimate(e.parentElement),this.imgArr=[],this.tempImgArr="../../../img/noImg.jpg",this.loadDataImg()}function initPack(e){this.parModal=e,this.loadAnimate=new loadAnimate(e.parentElement),this.loadPackList(),this.goodsArr=null}function initStore(e){this.parModal=e,this.loadAnimate=new loadAnimate(e.parentElement),this.loadStoreList(),this.storeList=null}function initReward(e){this.parModal=e,this.rewardList=[{goodsName:"点赞卡",goodsId:1,goodsImgSrc:"../../../img/tools1.png"},{goodsName:"换词卡",goodsId:2,goodsImgSrc:"../../../img/tools6.png"},{goodsName:"加时卡",goodsId:3,goodsImgSrc:"../../../img/tools4.png"},{goodsName:"金币",goodsId:0,goodsImgSrc:"../../../img/tools2.png"},{goodsName:"么么哒",goodsId:4,goodsImgSrc:"../../../img/tools3.png"},{goodsName:"番茄",goodsId:5,goodsImgSrc:"../../../img/tools5.png"},{goodsName:"糖果",goodsId:6,goodsImgSrc:"../../../img/tools7.png"}],this.todayGoodsId=null,this.initDom()}function initRank(e){this.parModal=e,this.loadAnimate=new loadAnimate(e.parentElement),this.giveMeMoreDom=null,this.meGiveMoreDom=null,this.rankListDom=null,this.myCharmDom=null,this.rankRightCon=null,this.pageDom=null,this.rankList=null,this.initDom(),this.onePageSize=Math.floor((this.rankRightCon.offsetHeight-dom.query(".topCon",this.rankRightCon).offsetHeight-30)/30)-1,this.loadRankData("charm"),this.loadMyData()}function initUser(e){this.parModal=e,this.loadAnimate=new loadAnimate(e.parentElement),this.loadUserData()}simpleModal.prototype.initDom=function(){this.backDrop=dom.createByHTML('<div class="modal-backdrop fade in"></div>'),dom.append(document.body,this.backDrop),this.modalDom=dom.createByHTML('<div class="simple-modal"></div>'),this.modalHeader=dom.createByHTML('<div class="modal-header"><h4>'+this.title+'</h4><i class="iconfont icon-guanbi1"></i></div>'),this.modalBody=dom.createByHTML('<div class="modal-body"></div>'),this.modalFooter=dom.createByHTML('<div class="modal-footer"></div>'),this.body&&(this.modalBody.innerHTML=this.body);for(var e=0,t=this.btn.length;e<t;e++)dom.append(this.modalFooter,dom.createByHTML('<button class="btn btn-default" data-id = '+e+" >"+this.btn[e].text+"</button>"));dom.append(this.modalDom,this.modalHeader),dom.append(this.modalDom,this.modalBody),dom.append(this.modalDom,this.modalFooter),dom.append(document.body,this.modalDom),this.modalDom.classList.add("modal-in-animate")},simpleModal.prototype.initEvent=function(){var e=this,t=dom.query("i",this.modalHeader);this.backDrop.addEventListener("click",function(){e.onClose.call(this,null),e.destory()}),t.addEventListener("click",function(){e.onClose.call(this,null),e.destory()}),this.modalFooter.addEventListener("click",function(t){var a=t.target;if("BUTTON"===a.tagName){var o=parseInt(a.dataset.id);"function"==typeof e.btn[o].cb&&e.btn[o].cb.call(a)}})},simpleModal.prototype.getBody=function(){return dom.query(".modal-body",this.modalDom)},simpleModal.prototype.destory=function(){var e=this;e.backDrop.classList.remove("in"),e.modalDom.classList.remove("modal-in-animate"),e.modalDom.classList.add("modal-out-animate"),setTimeout(function(){dom.remove(e.backDrop),dom.remove(e.modalDom)},150)},toast.prototype.init=function(){this.toastDom=dom.createByHTML('<div class="toast animateFadeIn"><span>'+this.text+"</span></div>"),dom.append(this.container,this.toastDom)},toast.prototype.destory=function(){var e=this;setTimeout(function(){e.toastDom.classList.remove("animateFadeIn"),e.toastDom.classList.add("animateFadeOut"),setTimeout(function(){dom.remove(e.toastDom)},1e3)},this.time-1e3)},Rect.prototype.clearOn=function(e){e.clearRect(this.x,this.y,this.w,this.h)},Rect.prototype.drawRect=function(e){e.strokeRect(this.x,this.y,this.w,this.h)},window.roomState=null,window.lockState=null,window.room=null,window.commonSocketStatus=null,window.socketInit=function(){var e=io.connect();room=new roomInit,e.on("roomMsg",function(e,t,a){t&&(roomState=JSON.parse(t)),a&&(lockState=JSON.parse(a)),room.init(JSON.parse(e),function(){setTimeout(function(){imgLoaded&&dom.hide(pDom.loading)},500)}),room.updateLock()}),e.on("roomMsgChange",function(e,t){t&&(roomState=JSON.parse(t)),room.init(JSON.parse(e),function(){setTimeout(function(){imgLoaded&&dom.hide(pDom.loading)},500)}),room.updateLock()}),e.on("lockRoomChange",function(e){e&&(lockState=JSON.parse(e)),room.updateLock()}),e.on("getGameInvate",function(e){var t=JSON.parse(e),a=new simpleModal({title:"游戏邀请",body:'<p style="text-align: center;line-height: 80px;">来自'+t.from+"的邀请</p>",btn:[{text:"接受",cb:function(){if(t.serverName===cache.get("serverName")){var e=t.roomId;room.handle(null,e)}else new toast({text:"未在同一服务区，不可进行游戏"});a.destory()}},{text:"拒绝",cb:function(){a.destory()}}]})}),e.on("connect",function(t){socketStatus.myLoading?socketStatus.myLoading.setText("连接成功"):socketStatus.myLoading=new loading({text:"连接成功"}),socketStatus.myLoading.hide(),e.emit("joinRoom",JSON.stringify(cache.get("email")))}),socketStatus.init(e)},window.pDom={},window.domInit=function(){this.pDom={pen:dom.query("#pen"),erase:dom.query("#erase"),clear:dom.query("#clear"),myColor:dom.query("#myColor"),penWidth:dom.query("#penWidth"),addTime:dom.query("#addTime"),changeWord:dom.query("#changeWord"),gameCenter:dom.query("#gameCenter"),roomClose:dom.query("#roomClose"),loading:dom.query("#loading"),currentSer:dom.query("#currentSer"),selectRoom:dom.query("#selectRoom"),header:dom.query("#header"),ready:dom.query("#ready"),readyText:dom.query(".gc-top-text",pDom.ready),lock:dom.query("#lock"),sendInvate:dom.query("#sendInvate"),paintMain:dom.query("#paintMain"),userList:dom.query("#userList"),leftTime:dom.query("#leftTime"),curData:dom.query(".cur-data"),keyWord:dom.query("#keyWord",pDom.curData),showDraw:dom.query("#showDraw"),back:dom.query("#back"),topMenu:dom.query(".top-menu"),message:dom.query("#message"),sendInput:dom.query(".sendInput",pDom.message),send:dom.query(".send",pDom.message),gameUser:dom.query("#gameUser"),msgList:dom.query("#msgList"),drawUtil:dom.query(".draw-util")}},function(){var e,t,a,o,n=(e={userDataModal:{action:"userData"},rankModal:{action:"rank"},rewardModal:{action:"reward"},storeModal:{action:"store"},packModal:{action:"pack"},galleryModal:{action:"gallery"}},t=null,a=function(){util.isPc()||(pDom.header.getAttribute("style")?pDom.header.removeAttribute("style"):pDom.header.setAttribute("style","height : 400px;"))},o=function(t){if(!dom.closest(t.target,".modal")){var a=dom.closest(t.target,".nav-icon-con");for(var o in e){var n=e[o];n&&(a?a.dataset.action!==n.action&&n.modal&&n.modal.hide():n.modal&&n.modal.hide())}}},document.body.addEventListener("click",o),document.body.addEventListener("touch",o),{cancle:function(){util.ajax({url:"/cancle",type:"get",success:function(e){"注销成功"===e&&(window.location.href=window.location.origin+"/loginPage")}})},userData:function(){a(),t&&t.hide();var o=e.userDataModal.modal;o?(o.show(),e.userDataModal.dataInit.update()):(e.userDataModal.modal=new Modal({title:"个人信息"}),e.userDataModal.dataInit=new initUser(e.userDataModal.modal.getBody())),t=o},rank:function(){a(),t&&t.hide();var o=e.rankModal.modal;o?(o.show(),e.rankModal.dataInit.update()):(e.rankModal.modal=new Modal({title:"排行榜"}),e.rankModal.dataInit=new initRank(e.rankModal.modal.getBody())),t=o},reward:function(){a(),t&&t.hide();var o=e.rewardModal.modal;o?(o.show(),e.rewardModal.dataInit.update()):(e.rewardModal.modal=new Modal({title:"每日奖励"}),e.rewardModal.dataInit=new initReward(e.rewardModal.modal.getBody())),t=o},store:function(){a(),t&&t.hide();var o=e.storeModal.modal;o?(o.show(),e.storeModal.dataInit.update()):(e.storeModal.modal=new Modal({title:"商城"}),e.storeModal.dataInit=new initStore(e.storeModal.modal.getBody())),t=o},pack:function(){a(),t&&t.hide();var o=e.packModal.modal;o?(o.show(),e.packModal.dataInit.update()):(e.packModal.modal=new Modal({title:"背包"}),e.packModal.dataInit=new initPack(e.packModal.modal.getBody())),t=o},gallery:function(){a(),t&&t.hide();var o=e.galleryModal.modal;o?(o.show(),e.galleryModal.dataInit.update()):(e.galleryModal.modal=new Modal({title:"画廊"}),e.galleryModal.dataInit=new initGallery(e.galleryModal.modal.getBody())),t=o}});window.chat=null,window.eventInit=function(){pDom.roomClose.addEventListener("click",function(){dom.hide(pDom.gameCenter),dom.show(pDom.selectRoom),dom.hide(pDom.paintMain),dom.show(pDom.userList),dom.show(pDom.loading),document.body.removeEventListener("touchmove",reactComFun.mbPreventDefault),pDom.readyText.innerText="准备",clientSocket.closeSocket(),reactEvent.stopAll(clientSocket.getSocket()),dom.show(pDom.ready),pDom.lock.classList.remove("hide"),pDom.sendInvate.classList.remove("hide")}),pDom.pen.addEventListener("click",function(){delete canvas.erase,new Rect(preErase.x,preErase.y,preErase.w,preErase.h).clearOn(ctx)}),pDom.erase.addEventListener("click",function(){canvas.erase=!0}),pDom.clear.addEventListener("click",function(){clientSocket.getSocket().emit("clearPaint",null)}),pDom.myColor.addEventListener("click",function(){var e=dom.query(".colorContainer",pDom.paintMain);if(e)dom.show(e);else{var t=dom.createByHTML("<div></div>");t.classList.add("colorContainer");for(var a=util.isPc()?24:4*Math.ceil((document.body.clientWidth-20)/60),o=0;o<a;o++){var n=dom.createByHTML("<div></div>"),i=util.randomColor();n.classList.add("oneColor"),n.style.backgroundColor=i,n.dataset.color=i,dom.append(t,n)}dom.append(pDom.paintMain,t),t.addEventListener("click",function(e){canvasUtil.setColor(canvas,e.target.dataset.color)})}}),pDom.penWidth.addEventListener("click",function(){var e=dom.query(".widthContainer",pDom.paintMain);if(e)dom.show(e);else{var t=dom.createByHTML("<div></div>");t.classList.add("widthContainer");for(var a=0;a<4;a++){var o=dom.createByHTML('<div data-width = "'+(a+1)+'"><div data-width = "'+(a+1)+'"></div></div>');dom.append(t,o)}dom.append(pDom.paintMain,t),t.addEventListener("click",function(e){canvasUtil.setLw(canvas,e.target.dataset.width)})}}),pDom.addTime.addEventListener("click",function(){var e=pDom.addTime.parentElement;if(dom.query(".wait",e))return!1;paintCom.addWait(e),util.ajax({url:"/reduceUserGoods",type:"post",data:{goodsId:3},success:function(e){var t=JSON.parse(e);200===t.status?clientSocket.getSocket().emit("addTime",null):new toast({text:t.errorMsg})}})}),pDom.changeWord.addEventListener("click",function(){var e=pDom.changeWord.parentElement;if(dom.query(".wait",e))return!1;paintCom.addWait(e),util.ajax({url:"/reduceUserGoods",type:"post",data:{goodsId:2},success:function(e){var t=JSON.parse(e);200===t.status?clientSocket.getSocket().emit("changeWord",null):new toast({text:t.errorMsg})}})}),pDom.ready.addEventListener("click",function(){var e=pDom.readyText,t=clientSocket.getSocket();e&&"准备"===e.innerText?(e.innerText="取消准备",t.emit("ready",null),reactEvent.stopAll(t)):(e.innerText="准备",t.emit("cancleReady",null))}),pDom.topMenu.addEventListener("click",function(e){e.preventDefault(),pDom.header.getAttribute("style")?pDom.header.removeAttribute("style"):pDom.header.setAttribute("style","height : 400px;")}),pDom.sendInput.addEventListener("focus",function(){util.isPc()||(document.body.scrollTop=0,pDom.message.style.top="0px",pDom.message.style.bottom="")}),pDom.sendInput.addEventListener("blur",function(){util.isPc()||(document.body.scrollTop=0,pDom.message.style.top="",pDom.message.style.bottom="0px")}),pDom.send.addEventListener("click",function(){var e=pDom.sendInput.value;if(pDom.showDraw.classList.contains("show"))return new toast({text:"本回合已结束，等下回合发送信息"}),!1;if(""!==e){var t=clientSocket.getSocket(),a={msg:pDom.sendInput.value,curUser:cache.get("paintUserEmail")};t.send(JSON.stringify(a)),pDom.sendInput.value=""}document.body.scrollTop=0}),pDom.sendInput.addEventListener("keyup",function(e){"13"==(e||window.event).keyCode&&(pDom.send.click(),this.value="")}),pDom.sendInvate.addEventListener("click",function(e){chat?chat.show():chat=new myChat({container:pDom.gameCenter,curSocket:function(){return clientSocket.getSocket()},roomId:function(){return room.getRoomId()}})}),pDom.userList.addEventListener("click",function(e){var t=e.target,a=t.dataset.friendEmail;"I"===t.tagName&&a&&util.ajax({url:"/addFriend",type:"post",data:{friendEmail:a},success:function(e){var t=JSON.parse(e);200===t.status?new toast({text:"好友请求已发送"}):new toast({text:t.errorMsg})}})}),pDom.lock.addEventListener("click",function(){var e=this;if("1"!==this.dataset.hasOpen){var t=clientSocket.getSocket(),a=new simpleModal({title:"添加房间密码",onClose:function(){e.dataset.hasOpen=0},btn:[{text:"确认",cb:function(){e.dataset.hasOpen=0;var n=dom.query("input",o).value;""!==n?(t.emit("addRoomLock",JSON.stringify({lockVal:n,roomId:room.getRoomId()})),a.destory(),new toast({text:"添加房间锁成功"})):new toast({text:"密码不能为空"})}},{text:"取消房间加密",cb:function(){e.dataset.hasOpen=0,t.emit("delRoomLock",JSON.stringify({roomId:room.getRoomId()})),a.destory(),new toast({text:"取消房间锁成功"})}}]}),o=dom.createByHTML('<div><input type="text" class="modal-input" placeholder="请输入密码" autofocus /></div>');dom.append(a.getBody(),o),this.dataset.hasOpen=1}}),pDom.header.addEventListener("click",function(e){switch((e.target.classList.contains("nav-icon-con")?e.target:e.target.parentElement).dataset.action){case"cancle":n.cancle();break;case"userData":n.userData();break;case"rank":n.rank();break;case"reward":n.reward();break;case"store":n.store();break;case"pack":n.pack();break;case"gallery":n.gallery()}}),document.body.addEventListener("click",function(e){if(!e.target.classList.contains("myColor")){var t=dom.query(".colorContainer");t&&dom.hide(t)}if(!e.target.classList.contains("penWidth")){var a=dom.query(".widthContainer");a&&dom.hide(a)}})}}(),initGallery.prototype.initDom=function(){this.parModal.innerHTML="";var e=dom.createByHTML('<div class="imgContainer"></div>'),t=dom.createByHTML('<div class="goodImg"></div>');this.curImg=dom.createByHTML('<img class="curImg" src="'+this.imgArr[0].imgSrc+'" />'),this.userDom=dom.createByHTML("<span >"+this.imgArr[0].userName+"</span>"),this.goodNumDom=dom.createByHTML('<span><i class="iconfont icon-dianzan"></i>'+this.imgArr[0].goodNum+"</span>"),dom.append(t,this.curImg),dom.append(e,t),dom.append(this.parModal,e),dom.append(t,this.userDom),dom.append(t,this.goodNumDom)},initGallery.prototype.loadDataImg=function(){var e=this;e.loadAnimate.show(),util.ajax({url:"/getGalleryImg",type:"get",success:function(t){var a=JSON.parse(t);if(e.parModal.innerHTML="",200===a.status){for(var o=a.data,n=[],i=0,s=o.length;i<s;i++){var r=o[i];n.push({imgSrc:"../../../../paint/"+r.img_url,userName:r.user_name,goodNum:r.img_points_num})}e.imgArr=n,e.initDom(),e.pageDom&&e.pageDom.destory(),e.pageDom=new pagePlugin({totalCounts:e.imgArr.length<10?e.imgArr.length:10,onePageSize:1,container:e.parModal,cb:function(t){var a=e.imgArr[t-1]&&e.imgArr[t-1].imgSrc||e.tempImgArr;e.curImg.src=a,e.userDom.innerText=a===e.tempImgArr?"":e.imgArr[t-1].userName,e.goodNumDom.innerHTML=a===e.tempImgArr?"":'<i class="iconfont icon-dianzan"></i>'+e.imgArr[t-1].goodNum}}),e.pageDom.updatePage(),e.loadAnimate.hide()}else 404===a.status?(e.parModal.innerHTML="<span>画廊暂无数据,快去参加比赛吧!!!</span>",e.loadAnimate.hide()):new toast({text:a.errorMsg})}})},initGallery.prototype.update=function(){this.loadDataImg()},initPack.prototype.loadPackList=function(){var e=this;e.loadAnimate.show(),util.ajax({url:"/getUserPackGoods",type:"get",success:function(t){var a=JSON.parse(t);if(200===a.status){e.parModal.innerHTML="";for(var o=a.data,n=[],i=0,s=o.length;i<s;i++){var r=o[i];n.push({goodsName:r.goods_name,goodsNum:r.goods_num,goodsImgSrc:"../../../img/"+r.goods_img})}e.goodsArr=n,e.initDom(),e.loadAnimate.hide()}else 404===a.status?(e.parModal.innerHTML="<span>背包暂无商品，快去购买吧!!!</span>",e.loadAnimate.hide()):new toast({text:a.errorMsg})}})},initPack.prototype.initDom=function(){this.parModal.innerHTML="";for(var e=dom.createByHTML('<div class="packContainer"></div>'),t=0,a=this.goodsArr.length;t<a;t++)dom.append(e,dom.createByHTML('<div> <img src = "'+this.goodsArr[t].goodsImgSrc+'"/> <span>'+this.goodsArr[t].goodsName+"</span><span>"+this.goodsArr[t].goodsNum+"</span> </div>"));dom.append(this.parModal,e)},initPack.prototype.update=function(){this.loadPackList()},initStore.prototype.loadStoreList=function(){var e=this;e.loadAnimate.show(),util.ajax({url:"/getStoreAllGoods",type:"get",success:function(t){var a=JSON.parse(t);if(200===a.status){for(var o=a.data,n=[],i=0,s=o.length;i<s;i++){var r=o[i];n.push({goodsName:r.goods_name,goodsPrice:r.goods_price,goodsImgSrc:"../../../img/"+r.goods_img,goodsId:r.goods_id})}e.storeList=n,e.initDom(),e.loadAnimate.hide()}else 404===a.status?new toast({text:"商城数据为空"}):new toast({text:a.errorMsg})}})},initStore.prototype.initDom=function(){for(var e=dom.createByHTML('<div class="storeContainer"></div>'),t=this,a=0,o=this.storeList.length;a<o;a++){var n=this.storeList[a],i=dom.createByHTML("<div></div>"),s=dom.createByHTML("<img />");s.src=n.goodsImgSrc;var r=dom.createByHTML('<span><i class="iconfont icon-qiandai"></i>'+n.goodsPrice+"</span>"),d=dom.createByHTML("<button></button>");d.innerText="买",d.dataset.goodsId=n.goodsId,d.addEventListener("click",function(e){t.buy(e.target.dataset.goodsId)}),dom.append(i,s),dom.append(i,r),dom.append(i,d),dom.append(e,i)}dom.append(this.parModal,e)},initStore.prototype.buy=function(e){util.ajax({url:"/buyGoods",type:"post",data:{goodsId:e},success:function(e){var t=JSON.parse(e);200===t.status?new toast({text:"道具购买成功"}):new toast({text:t.errorMsg})}})},initStore.prototype.update=function(){},initReward.prototype.initDom=function(){for(var e=dom.createByHTML('<div class="rewardContainer"></div>'),t=this,a=(new Date).getDay(),o=0;o<7;o++){var n=this.rewardList[o],i=dom.createByHTML("<div></div>"),s=dom.createByHTML('<div class="reward"></div>'),r=dom.createByHTML("<img />"),d=dom.createByHTML("<span></span>");s.innerText="第"+(o+1)+"天",d.innerText=n.goodsName,r.src=n.goodsImgSrc,dom.append(i,s),dom.append(i,r),dom.append(i,d),dom.append(e,i),0===a&&6===o&&(s.classList.add("rewardToday"),this.todayGoodsId=n.goodsId),a-o==1&&(s.classList.add("rewardToday"),this.todayGoodsId=n.goodsId)}var c=dom.createByHTML("<span>累计登录七天领取绘画奖励，每周一重置</span>"),m=dom.createByHTML("<button></button>");m.innerText="领取","1"===cache.get(cache.get("email")+"hasReceive")&&(m.innerText="今日已领取",m.setAttribute("disabled","disabled"),m.classList.add("btn-disabled")),m.addEventListener("click",function(e){t.getGoods(),m.innerText="今日已领取",m.setAttribute("disabled","disabled"),m.classList.add("btn-disabled"),cache.add(cache.get("email")+"hasReceive","1")}),dom.append(e,c),dom.append(e,m),dom.append(this.parModal,e)},initReward.prototype.getGoods=function(){0===this.todayGoodsId?util.ajax({url:"/updateUser",type:"post",data:{updateData:JSON.stringify({gold_num:100})},success:function(e){var t=JSON.parse(e);200===t.status?new toast({text:"金币领取成功"}):new toast({text:t.errorMsg})}}):util.ajax({url:"/addUserGoods",type:"post",data:{goodsId:this.todayGoodsId},success:function(e){var t=JSON.parse(e);200===t.status?new toast({text:"道具领取成功"}):new toast({text:t.errorMsg})}})},initReward.prototype.update=function(){},initRank.prototype.loadRankData=function(e){var t=this;t.loadAnimate.show(),util.ajax({url:"charm"===e?"/getCharmRank":"/getSlotsRank",type:"get",success:function(a){var o=JSON.parse(a);if(200===o.status){for(var n=o.data,i=[],s=0,r=n.length;s<r;s++){var d=n[s];i.push({userName:d.user_name,receiveGoods:"charm"===e?d.charm_num:d.slots_num,imgUrl:"../../../../head/"+d.head_url})}t.rankList=i,t.initRankData(t.rankList.slice(0,t.onePageSize),0),t.pageDom&&t.pageDom.destory(),t.pageDom=new pagePlugin({totalCounts:t.rankList.length,onePageSize:t.onePageSize,container:t.rankRightCon,cb:function(e){t.initRankData(t.rankList.slice((e-1)*t.onePageSize,e*t.onePageSize),(e-1)*t.onePageSize)}}),t.pageDom.updatePage(),t.loadAnimate.hide()}else 404===o.status?new toast({text:"排行榜信息为空"}):new toast({text:o.errorMsg})}})},initRank.prototype.initDom=function(){var e=dom.createByHTML('<div class="rankContainer"></div>'),t=dom.createByHTML('<div class="rankLeftCon"><div><span>我的魅力数</span><span class="myCharm">0</span></div><div><p>谁送我么么哒糖果最多</p><div class="giveMeMore"></div></div><div><p>我心仪的人</p><div class="meGiveMore"></div></div></div>');this.rankRightCon=dom.createByHTML('<div class="rankRightCon"><div class="topCon"><div class="rankSelect" data-type = "charm">魅力榜</div><div data-type = "slots">吐槽榜</div></div><div class="rankList"></div></div>');var a=dom.query(".topCon",this.rankRightCon),o=this;a.addEventListener("click",function(e){for(var t=a.children,n=e.target,i=0,s=t.length;i<s;i++)t[i].classList.remove("rankSelect");n.classList.add("rankSelect"),"charm"===n.dataset.type?o.loadRankData("charm"):o.loadRankData("slots")}),dom.append(e,t),dom.append(e,this.rankRightCon),dom.append(this.parModal,e),this.giveMeMoreDom=dom.query(".giveMeMore",t),this.meGiveMoreDom=dom.query(".meGiveMore",t),this.myCharmDom=dom.query(".myCharm",t),this.rankListDom=dom.query(".rankList",this.rankRightCon)},initRank.prototype.initRankData=function(e,t){var a=document.createDocumentFragment();this.rankListDom.innerHTML="";var o=dom.createByHTML("<div><div><span>排名</span></div><div><span>玩家名称</span></div><div><span>数量</span></div></div>");dom.append(a,o);for(var n=0,i=e.length;n<i;n++){var s=e[n],r=dom.createByHTML("<div><div><span>"+(n+t+1)+'</span></div><div><img src="'+s.imgUrl+'" /><span>'+s.userName+"</span></div><div><span>"+s.receiveGoods+"</span></div></div>");dom.append(a,r)}dom.append(this.rankListDom,a)},initRank.prototype.initMyData=function(e,t,a){if(this.myCharmDom.innerText=e,this.giveMeMoreDom.innerHTML="",this.meGiveMoreDom.innerHTML="",t){var o=dom.createByHTML('<div><img src="'+t.headUrl+'" /> <span title="'+t.userName+'">'+t.userName+"</span></div>");dom.append(this.giveMeMoreDom,o)}else{var n=dom.createByHTML("<span>主动出击,先送上魅力值引起TA的注意</span>");dom.append(this.giveMeMoreDom,n)}if(a){var i=dom.createByHTML('<div><img src="'+a.headUrl+'" /> <span title="'+a.userName+'">'+a.userName+"</span></div>");dom.append(this.meGiveMoreDom,i)}else{n=dom.createByHTML("<span>妈妈说:不送魅力值给妹子，一辈子都会打光棍</span>");dom.append(this.meGiveMoreDom,n)}},initRank.prototype.loadMyData=function(){var e=this;util.ajax({url:"/getMyRankData",type:"get",success:function(t){var a=JSON.parse(t),o=null,n=null;a.giveMeMoreUser&&(o={userName:a.giveMeMoreUser.user_name,headUrl:"../../../../head/"+a.giveMeMoreUser.head_url}),a.meGiveMoreUser&&(n={userName:a.meGiveMoreUser.user_name,headUrl:"../../../../head/"+a.meGiveMoreUser.head_url}),e.initMyData(a.charm_num,o,n)}})},initRank.prototype.update=function(){},initUser.prototype.loadUserData=function(){var e=this;e.loadAnimate.show(),util.ajax({url:"/getUserDataByEmail",type:"post",data:{email:cache.get("email")},success:function(t){var a=JSON.parse(t);if(200===a.status){var o=a.data[0];e.userDataList=[{userColName:"头像",data:"../../../../head/"+o.head_url},{userColName:"邮箱",data:o.email},{userColName:"用户名称",data:o.user_name},{userColName:"性别",data:o.sex},{userColName:"金币数量",data:o.gold_num},{userColName:"魅力值",data:o.charm_num},{userColName:"吐槽值",data:o.slots_num}],e.initDom(),e.loadAnimate.hide()}else 404===a.status?new toast({text:"用户数据为空"}):new toast({text:a.errorMs})}})},initUser.prototype.initDom=function(){this.parModal.innerHTML="";for(var e=dom.createByHTML('<div class="userContainer"></div>'),t=dom.createByHTML('<div class="userDataLeftCon"></div>'),a=dom.createByHTML('<div class="userDataRightCon"></div>'),o=1,n=this.userDataList.length;o<n;o++){var i=this.userDataList[o],s=dom.createByHTML("<div><span>"+i.userColName+":</span><span>"+i.data+"</span></div>");dom.append(a,s)}dom.append(this.parModal,e),dom.append(e,t),dom.append(e,a);var r=dom.createByHTML("<img />");r.src=this.userDataList[0].data;var d=dom.createByHTML("<button></button>");d.innerText="更换头像";var c=dom.createByHTML('<input type="file" id="btn_file" style="display:none">');d.addEventListener("click",function(e){document.getElementById("btn_file").click()}),c.addEventListener("change",function(e){if("undefined"==typeof FileReader)new toast({text:"对不起!您使用的浏览器不支持修改头像"});else{var t=new FileReader;t.onload=function(e){var t=e.target.result;r.src=t;var a=util.dataURLtoBlob(t),o=new FormData;o.append("imgBlob",a),util.ajax({url:"changeUserHead",type:"post",async:!1,data:o,contentType:!0,success:function(e){var t=JSON.parse(e);200===t.status?new toast({text:"头像修改成功"}):500===t.status?new toast({text:t.errorMsg}):new toast({text:"网络问题，请刷新重试"})}})},t.readAsDataURL(this.files[0])}}),dom.append(t,c),dom.append(t,r),dom.append(t,d)},initUser.prototype.update=function(){this.loadUserData()};var roomInit=function(){function e(){this.divCache=[],this.divContainer=document.createElement("div"),this.divContainer.classList.add("animated","fadeInRight"),this.hasInRoom=!1,this.roomId=null,this.serverName=cache.get("serverName"),pDom.selectRoom.appendChild(this.divContainer)}return e.prototype.getRoomDivs=function(){return this.divCache},e.prototype.getRoomId=function(){return this.roomId},e.prototype.loadRoom=function(){dom.show(pDom.loading),clientSocket.initGameSocket(this,function(){dom.show(pDom.gameCenter),dom.hide(pDom.selectRoom),setTimeout(function(){imgLoaded&&dom.hide(pDom.loading)},500)}),this.hasInRoom=!0},e.prototype.handle=function(e,t){var a=this;if(this.hasInRoom)new toast({text:"请您先退出该房间，再接受游戏邀请"});else{var o=t||dom.closest(e.target,".roomDiv").dataset.roomId,n=lockState[a.serverName][o];if(this.roomId=o,roomState&&roomState[this.serverName][o])return void new toast({text:"该房间已经开始游戏，请您另外选择"});if(lockState&&n){var i=dom.createByHTML('<div><input type="text" class="modal-input" placeholder="请输入密码" autofocus /></div>'),s=new simpleModal({title:"输入房间密码",btn:[{text:"确认",cb:function(){var e=dom.query("input",i);n===e.value?(a.loadRoom(),s.destory()):new toast({text:"房间密码错误请重新输入"})}}]});dom.append(s.getBody(),i)}else this.loadRoom()}},e.prototype.destory=function(){if(this.divCache.length>0){this.divContainer.innerHTML="";for(var e=0,t=this.divCache.length;e<t;e++)this.divCache[e].removeEventListener("click",this.handle);this.divCache=[]}},e.prototype.init=function(e,t){this.destory();for(var a=0;a<20;a++){var o=document.createElement("div"),n=document.createElement("i"),i=document.createElement("span"),s=!1;for(var r in this.divCache.push(o),i.innerHTML="- "+(a+1)+" -",n.classList.add("iconfont","icon-huabi","roomIcon"),o.classList.add("roomDiv"),e[this.serverName])if(r==="room"+a){for(var d=0;d<4;d++)if(e[this.serverName][r][d]){var c=document.createElement("div"),m=document.createElement("i"),l=document.createElement("p");l.innerHTML=e[this.serverName][r][d],l.classList.add("userP"),m.classList.add("iconfont","icon-touxiang","userIcon","active"),c.classList.add("userIcon"+d),c.appendChild(m),c.appendChild(l),o.appendChild(c)}else{(m=document.createElement("i")).classList.add("iconfont","icon-wenhao3","userIcon"+d),o.appendChild(m)}s=!0,e[this.serverName][r].length>0&&n.classList.add("active")}if(!s)for(d=0;d<4;d++){(m=document.createElement("i")).classList.add("iconfont","icon-wenhao3","userIcon"+d),o.appendChild(m)}o.appendChild(n);var p=dom.createByHTML('<div class="index-con"></div>');p.classList.add("roomIndex"),dom.append(p,i),o.appendChild(p),o.dataset.roomId="room"+a,o.addEventListener("click",this.handle.bind(this)),this.divContainer.appendChild(o)}"function"==typeof t&&t()},e.prototype.updateLock=function(){for(var e=lockState[this.serverName],t=0,a=this.divCache.length;t<a;t++){var o=this.divCache[t],n=dom.query(".index-con",o),i=dom.query("i",n);if(e[o.dataset.roomId]&&!i){var s=dom.createByHTML('<i class="iconfont icon-suo" style="color: #f44336;"></i>');dom.append(n,s)}else!e[o.dataset.roomId]&&i&&dom.remove(i)}},e}(),canvas=document.getElementsByTagName("canvas")[0],ctx=canvas.getContext("2d"),roomTimer=null,userTimer=null,tipsTimer=null,meTimeData=null,imgArr=[],curGameUser=null,loadAni=null,preErase={x:0,y:0,w:0,h:0},_eventHandle={pcMouseDown:function(e){e.preventDefault(),e.stopPropagation();var t=e.offsetX,a=e.offsetY;if(_eventHandle.isDown=!0,this.erase){if(preErase.x&&preErase.y&&preErase.w&&preErase.h)new Rect(preErase.x,preErase.y,preErase.w,preErase.h).clearOn(ctx);var o=new Rect(t-10,a-10,20,20);return o.clearOn(ctx),o.drawRect(ctx),preErase.x=t-10-2,preErase.y=a-10-2,preErase.w=24,preErase.h=24,void bindEvent._socket.emit("erase",o.x,o.y,o.w,o.h)}canvasUtil.clearPos(canvas),canvasUtil.addPos(canvas,t,a)},pcMouseMove:function(e){e.preventDefault(),e.stopPropagation();var t=e.offsetX,a=e.offsetY;if(_eventHandle.isDown)if(this.erase){var o;if(preErase.x&&preErase.y&&preErase.w&&preErase.h)(o=new Rect(preErase.x,preErase.y,preErase.w,preErase.h)).clearOn(ctx);(o=new Rect(t-10,a-10,20,20)).clearOn(ctx),o.drawRect(ctx),preErase.x=t-10-2,preErase.y=a-10-2,preErase.w=24,preErase.h=24,bindEvent._socket.emit("erase",o.x,o.y,o.w,o.h)}else canvasUtil.addPos(canvas,t,a),canvasUtil.drawPts(canvas,ctx,this.pts),bindEvent._socket.emit("paint",JSON.stringify({data:new Path(this.pts),status:"ing"}))},pcMouseUp:function(e){if(e.preventDefault(),e.stopPropagation(),_eventHandle.isDown=!1,!this.erase){var t=e.offsetX,a=e.offsetY;canvasUtil.addPos(canvas,t,a),canvasUtil.addPath(canvas,this.pts),bindEvent._socket.emit("paint",JSON.stringify({data:new Path(this.pts),status:"end"})),canvasUtil.clearPos(canvas)}},mbTouchStart:function(e){e.preventDefault(),e.stopPropagation();var t=canvas.getBoundingClientRect(),a=e.targetTouches[0],o=a.clientX-t.left,n=a.clientY-t.top;if(_eventHandle.isDown=!0,this.erase){if(preErase.x&&preErase.y&&preErase.w&&preErase.h)new Rect(preErase.x,preErase.y,preErase.w,preErase.h).clearOn(ctx);var i=new Rect(o-10,n-10,20,20);return i.clearOn(ctx),i.drawRect(ctx),preErase.x=o-10-2,preErase.y=n-10-2,preErase.w=24,preErase.h=24,void bindEvent._socket.emit("erase",i.x,i.y,i.w,i.h)}canvasUtil.clearPos(canvas),canvasUtil.addPos(canvas,o,n)},mbTouchMove:function(e){e.preventDefault(),e.stopPropagation();var t=canvas.getBoundingClientRect(),a=e.targetTouches[0],o=a.clientX-t.left,n=a.clientY-t.top;if(_eventHandle.isDown)if(this.erase){var i;if(preErase.x&&preErase.y&&preErase.w&&preErase.h)(i=new Rect(preErase.x,preErase.y,preErase.w,preErase.h)).clearOn(ctx);(i=new Rect(o-10,n-10,20,20)).clearOn(ctx),i.drawRect(ctx),preErase.x=o-10-2,preErase.y=n-10-2,preErase.w=24,preErase.h=24,bindEvent._socket.emit("erase",i.x,i.y,i.w,i.h)}else canvasUtil.addPos(canvas,o,n),canvasUtil.drawPts(canvas,ctx,this.pts),bindEvent._socket.emit("paint",JSON.stringify({data:new Path(this.pts),status:"ing"}))},mbTouchEnd:function(e){e.preventDefault(),e.stopPropagation(),_eventHandle.isDown=!1,this.erase||(bindEvent._socket.emit("paint",JSON.stringify({data:new Path(this.pts),status:"end"})),canvasUtil.clearPos(canvas))},isDown:!1},bindEvent={bindCanvasEvent:function(e){bindEvent._socket=e,util.isPc()?(canvas.addEventListener("mousedown",_eventHandle.pcMouseDown),canvas.addEventListener("mousemove",_eventHandle.pcMouseMove),canvas.addEventListener("mouseup",_eventHandle.pcMouseUp)):(canvas.addEventListener("touchstart",_eventHandle.mbTouchStart),canvas.addEventListener("touchmove",_eventHandle.mbTouchMove),canvas.addEventListener("touchend",_eventHandle.mbTouchEnd))},removeCanvasEvent:function(){util.isPc()?(canvas.removeEventListener("mousedown",_eventHandle.pcMouseDown),canvas.removeEventListener("mousemove",_eventHandle.pcMouseMove),canvas.removeEventListener("mouseup",_eventHandle.pcMouseUp)):(canvas.removeEventListener("touchstart",_eventHandle.mbTouchStart),canvas.removeEventListener("touchmove",_eventHandle.mbTouchMove),canvas.removeEventListener("touchend",_eventHandle.mbTouchEnd))},socket:null},reactEvent={updateUserList:function(e){if(e instanceof Array&&e.length>0){var t,a,o=dom.queryAll(".userBottom");for(t=0,a=o.length;t<a;t++)o[t].innerHTML="",o[t].previousSibling.removeAttribute("style"),dom.closest(o[t],".user").removeAttribute("style");for(t=0,a=e.length;t<a;t++){var n=o[t],i=e[t];n.innerHTML='<span class = "userName">'+i.userName+'</span><span class = "readyText">'+(i.isReady?"准备":"未准备")+"</span>"+(i.email===cache.get("email")?"":'<i class="iconfont icon-tianjiahaoyou1 add-friend" data-friend-email = "'+i.email+'"></i>'),n.previousSibling.style.color="rgb(0,170,251)",dom.closest(n,".user").style.borderColor="rgb(0,170,251)"}}curGameUser=e},updateReady:function(e,t,a){for(var o=dom.queryAll(".userBottom"),n=0,i=o.length;n<i;n++){var s=dom.query(".userName",o[n]);if(s&&s.innerText===t)dom.query(".readyText",o[n]).innerText="ready"===e?"准备":"未准备"}"cancleReady"===e&&reactEvent.stopAll(a)},isMeTime:function(e,t){bindEvent.bindCanvasEvent(e),pDom.sendInput.setAttribute("disabled",!0),pDom.keyWord.innerText="关键字:"+t.keyWord,meTimeData=t,dom.show(pDom.drawUtil)},notMeTime:function(e){dom.hide(pDom.drawUtil),bindEvent.removeCanvasEvent(e),pDom.sendInput.removeAttribute("disabled")},gameStart:function(e,t){var a=document.createElement("h1");a.classList.add("time"),document.body.appendChild(a),dom.show(pDom.back),util.isPc()&&(pDom.msgList.innerHTML=""),paintCom.initGameList(),(roomTimer=util.countDown("/src/js/timerJs/startTimer.js",function(o){a.innerHTML="游戏开始还有"+o.data+"秒钟",0==o.data&&(roomTimer.stopWorker(),dom.hide(pDom.back),util.isPc()&&pDom.msgList.appendChild(dom.createByHTML("<p>***回合开始***</p>")),reactComFun.show(),t==cache.get("userName")&&e.emit("firstGamer",null))},function(){dom.queryAll(".time").length>0&&document.body.removeChild(a)})).startWorker(),imgArr=[]},gameRestart:function(){pDom.sendInput.removeAttribute("disabled"),reactComFun.hide()},gameEnd:function(e){bindEvent.removeCanvasEvent(e),e.emit("gameEnd",null),reactComFun.hide();for(var t=[],a=pDom.gameUser.children,o=0,n=a.length;o<n;o++){var i=a[o],s=dom.query("[data-user-name]",i);t.push({headUrl:"./head/"+dom.query(".avator",i).dataset.head,userName:s.dataset.userName,email:i.dataset.email,score:parseInt(s.childNodes[0].nodeValue)})}for(o=1,n=t.length;o<n;o++)for(var r=o;r>0&&t[r].score>t[r-1].score;r--){i=t[r-1];t[r-1]=t[r],t[r]=i}var d=dom.createByHTML('<div class="game-result animated lightSpeedIn"></div>'),c=dom.createByHTML('<i class="iconfont icon-guanbi1" style="font-size: 20px"></i>');c.addEventListener("click",function(e){d.classList.remove("lightSpeedIn"),d.classList.add("lightSpeedOut"),setTimeout(function(){dom.remove(d)},1e3)}),dom.append(d,dom.createByHTML("<span>本局游戏结果</span>")),dom.append(d,c);var m=dom.createByHTML("<h4>恭喜玩家:"+t[0].userName+":获得200金币</h4>");dom.append(d,m);var l=dom.createByHTML("<div><div><span>排名</span></div><div><span>玩家名称</span></div><div><span>本局积分</span></div></div>");for(dom.append(d,l),o=0,n=t.length;o<n;o++){i=t[o];var p=dom.createByHTML("<div><div><span>"+(o+1)+'</span></div><div class="userName"><img src="'+i.headUrl+'" /><span>'+i.userName+"</span></div><div><span>"+i.score+"</span></div></div>");dom.append(d,p)}var u=dom.createByHTML("<button>显示本局绘图</button>");u.addEventListener("click",function(){for(var e="",t=0,a=imgArr.length;t<a;t++)e+='<img class="page'+(t+1)+'" src="'+imgArr[t]+'" />';if(a<4)for(var o=4-a,n=0,i=0;n<o;)n++,i>=a&&(i=0),e+='<img class="page'+(n+a)+'" src="'+imgArr[i]+'" />',i++;var s=dom.createByHTML('<div class="stage2 animated bounceInDown">    <div class="rectContainer" style = "transform:rotateY(0deg);">'+e+'    </div><i class="iconfont icon-iconfontzuo pre"></i><i class="iconfont icon-xiayiyeqianjinchakangengduo-xianxingyuankuang next"></i><i class="iconfont icon-guanbi1 close"></i><h5>本局绘图图片</h5></div>'),r=dom.query(".pre",s),d=dom.query(".next",s),c=dom.query(".close",s),m=dom.query(".rectContainer",s),l=function(){var e=m.style.transform,t=parseInt(e.match(/[-]*\d+/)[0]);m.style.transform="rotateY("+(t-90)+"deg)"},p=function(){var e=m.style.transform,t=parseInt(e.match(/[-]*\d+/)[0]);m.style.transform="rotateY("+(t+90)+"deg)"};r.addEventListener("click",l),d.addEventListener("click",p),c.addEventListener("click",function(){s.classList.remove("bounceInDown"),s.classList.add("bounceOutDown"),setTimeout(function(){r.removeEventListener("click",l),d.removeEventListener("click",p),dom.remove(s)},1e3)}),dom.append(document.body,s)}),dom.append(d,u),dom.append(pDom.gameCenter,d),t[0].email===cache.get("email")&&util.ajax({url:"/updateUser",type:"post",data:{email:t[0].email,updateData:JSON.stringify({gold_num:200})},success:function(e){var t=JSON.parse(e);500===t.status&&new toast({text:t.errorMsg})}})},clearPaint:function(){canvasUtil.clearPaint(ctx,canvas),dom.hide(pDom.showDraw)},curGameData:function(e){tipsTimer&&tipsTimer.stopWorker();var t=e.userName,a=e.email,o=e.subscribe,n=cache.get("userName"),i=parseInt(e.isChange);if(cache.add("paintUser",t),cache.add("paintUserEmail",a),cache.add("keyWordSubscr",o),e.word&&a===cache.get("email")&&(pDom.keyWord.innerText="关键字:"+e.word,meTimeData.keyWord=e.word),util.isPc()&&!i){var s=document.createElement("p");s.innerText="现在由"+t+"作图",pDom.msgList.appendChild(s)}var r=null;if((tipsTimer=util.countDown("/src/js/timerJs/tipsTimer.js",function(e){var a=null,i=function(){r={msg:a,isRight:"true"},reactEvent.getMessage(r),t!==n&&(pDom.keyWord.innerText="提示:"+a)};switch(e.data){case 12:a=o.wordNum+"个字",i();break;case 6:a=o.wordType,i();break;case 0:a=o.wordTips,i(),tipsTimer.stopWorker()}})).startWorker(),!i){var d=dom.queryAll("[data-user-name]",pDom.gameUser);dom.remove(dom.query(".drawIcon"),pDom.gameUser);for(var c=0,m=d.length;c<m;c++)if(d[c].dataset.userName===t){var l=d[c].parentElement,p=dom.createByHTML('<i class="iconfont icon-qianbipencil82 drawIcon"></i>');dom.append(l,p)}}},stopAll:function(e){pDom.leftTime.innerText="",bindEvent.removeCanvasEvent(e),roomTimer&&roomTimer.stopWorker(),userTimer&&userTimer.stopWorker(),tipsTimer&&tipsTimer.stopWorker()},showAnswer:function(e,t){userTimer&&userTimer.stopWorker(),tipsTimer&&tipsTimer.stopWorker(),cache.add("keyWord",t),paintCom.initShowImgTime(),pDom.keyWord.innerText="暂无提示";var a=document.createElement("div"),o=document.createElement("h3"),n=document.createElement("img");a.classList.add("imgContainer"),util.isPc()?(n.style.width="300px",n.style.height="300px"):(n.style.width=document.body.clientWidth-.12*document.body.clientWidth-40+"px",n.style.height=document.body.clientHeight-.4*document.body.clientHeight-50+"px"),canvasUtil.canvasToPng(canvas,imgArr,function(e){n.src=e}),o.innerHTML="<span style='font-size: 12px;'>答案:</span><span style='font-size: 16px;color: red;font-weight: 900;'>"+t+"</span>",a.appendChild(o),a.appendChild(n),dom.show(pDom.showDraw);var i=dom.query(".imgContainer",pDom.showDraw);i&&dom.remove(i),pDom.showDraw.appendChild(a),paintCom.initGiveProp(e)},getMessage:function(e){if("true"===e.isRight&&cache.add("hasAnswer","true"),util.isPc()&&pDom.userList.classList.contains("hide")){var t="true"===e.isRight?"系统提示:"+e.msg:e.userName+"说:"+e.msg;pDom.msgList.appendChild(dom.createByHTML("<p>"+t+"</p>")),pDom.msgList.scrollTop=pDom.msgList.scrollHeight}else{var a,o=dom.createByHTML('<span class="msg"></span>'),n=Math.floor(135*Math.random())+35+"px;",i=util.randomColor();o.style.cssText="bottom:"+n+"color:"+i,o.innerText="true"===e.isRight?"系统提示:"+e.msg:e.userName+"说:"+e.msg,dom.append(document.body,o);var s=-o.offsetWidth,r=document.body.clientWidth+o.offsetWidth;o.style.right=s+"px",o.classList.add("opacity1"),a=setInterval(function(){s+=2,o.style.right=s+"px",s>r&&(clearInterval(a),document.body.contains(o)&&document.body.removeChild(o))},10)}},updateScore:function(e){for(var t=dom.queryAll("[data-user-name]",pDom.gameUser),a=e.roomScore,o=0,n=t.length;o<n;o++)for(var i=0,s=a.length;i<s;i++){var r=t[o].dataset.userName;if(r===a[i].userName&&(t[o].innerHTML="",t[o].innerText=a[i].score,r===e.changeUser||cache.get("paintUser")===a[i].userName)){var d=r===e.changeUser?"+5分":"+8分",c=dom.createByHTML('<div class="tips"></div>');c.innerText=d,dom.append(t[o],c),c.classList.add("animated","fadeInDown")}}},userAllAnswerRight:function(e){paintCom.emitNextUser(e)},startTimer:function(e,t){reactComFun.startGameTimer(function(a){pDom.leftTime.innerText=a.data.timeLeft,0===a.data.timeLeft&&(pDom.leftTime.innerText="",userTimer.stopWorker(),t.curPaint===cache.get("email")&&paintCom.emitNextUser(e))})},setAnswerImgId:function(e){var t=dom.query("img",dom.query(".imgContainer",pDom.showDraw));t&&(t.dataset.id=e),loadAni&&loadAni.hide()},showProp:function(e){var t=JSON.parse(e);paintCom.animate(t.iconClass,t.iconAnimateClass)},addTime:function(){userTimer.getWorker().postMessage(50),new toast({text:"作画者使用加时卡，增加作画间50秒"})},changeWord:function(){new toast({text:"作画者使用换词卡，关键词更换"})}},paintCom={initGameList:function(){pDom.gameUser.innerHTML="";for(var e=[],t=0,a=curGameUser.length;t<a;t++){var o=document.createElement("div");o.classList.add("userDiv"),o.dataset.email=curGameUser[t].email;var n=document.createElement("div");n.classList.add("avator"),n.style.backgroundImage="url(./img/head/loadingHead.jpg)";var i=document.createElement("p");i.innerText=curGameUser[t].userName;var s=document.createElement("p");s.innerText="0",s.dataset.userName=curGameUser[t].userName,o.appendChild(n),o.appendChild(i),o.appendChild(s),pDom.gameUser.appendChild(o),e.push(curGameUser[t].email)}util.ajax({url:"/getRoomUsersData",type:"post",data:{emailArr:e},success:function(e){var t=JSON.parse(e);if(200===t.status){for(var a=t.data,o=pDom.gameUser.children,n=0,i=a.length;n<i;n++)for(var s=0,r=o.length;s<r;s++)if(o[s].dataset.email===a[n].email){var d=dom.query(".avator",o[s]);d.dataset.head=a[n].head_url,d.style.backgroundImage="url(./head/"+a[n].head_url+")"}}else 404===t.status?new toast({text:"房间用户头像信息为空"}):new toast({text:t.errorMs})}})},initShowImgTime:function(){var e=dom.query(".showDrawTime",pDom.showDraw);e&&dom.remove(e);var t=dom.createByHTML('<p class="showDrawTime">倒计时:10</p>'),a=10;dom.append(pDom.showDraw,t);var o=setInterval(function(){0===a?clearInterval(o):(a--,t.innerText="倒计时:"+a)},1e3)},initGiveProp:function(e){var t=dom.query(".btnCon",pDom.showDraw);if(t&&dom.remove(t),cache.get("paintUserEmail")===cache.get("email"))return!1;util.ajax({url:"/getUserPackGoods",type:"get",success:function(t){var a=JSON.parse(t);if(200===a.status||404===a.status){for(var o=a.data,n=[{btn:null,data:{num:0,goodsId:4},iconClass:"icon-zuichun",iconAnimate:"iconMeMeDaAnimate"},{btn:null,data:{num:0,goodsId:6},iconClass:"icon-tangguo",iconAnimate:"iconCandyAnimate"},{btn:null,data:{num:0,goodsId:5},iconClass:"icon-fanqie",iconAnimate:"iconTomatoAnimate"},{btn:null,data:{num:0,goodsId:1},iconClass:"icon-dianzan1",iconAnimate:"iconZanAnimate"}],i=0,s=o.length;i<s;i++)for(var r=o[i],d=0,c=n.length;d<c;d++){var m=n[d].data;r.goods_id===m.goodsId&&(m.num=r.goods_num)}var l=dom.createByHTML('<div class="btnCon"></div>');for(i=0,s=n.length;i<s;i++){var p=n[i],u=(t=p.data,dom.createByHTML('<div data-id = "'+t.goodsId+'"><i class="iconfont '+p.iconClass+'"></i><span>'+t.num+"</span></div>"));p.btn=u,dom.append(l,u),0===t.num&&(dom.query("i",p.btn).classList.add("notHave"),dom.query("span",p.btn).classList.add("notHave"))}dom.append(pDom.showDraw,l),l.addEventListener("click",function(t){var a=t.target;if(a===this)return!1;var o=dom.closest(a,"[data-id]"),i=parseInt(dom.query("span",o).innerText);if(dom.query(".wait",o))return!1;if(paintCom.addWait(o),0===i)return new toast({text:"道具数量不足，无法赠送"}),!1;var s=parseInt(o.dataset.id),r=1,d={reduceGoodsId:s,paint_user_email:cache.get("paintUserEmail")};5===s&&(r=0),r?d.give_charm_num=1:d.give_slots_num=1;for(var c=null,m=null,l=0,p=n.length;l<p;l++){var u=n[l];if(u.btn===o){c=u.iconClass,m=u.iconAnimate;break}}if(1===s){var h=dom.query("img",dom.query(".imgContainer",pDom.showDraw)).dataset.id;h&&(util.ajax({url:"/reduceUserGoods",type:"post",data:{goodsId:1},success:function(t){var a=JSON.parse(t);if(200===a.status){var n=dom.query("span",o);i-1==0?(dom.query("i",o).classList.add("notHave"),n.classList.add("notHave"),n.innerText=0):n.innerText=parseInt(n.innerText)-1,e.emit("userGiveProp",JSON.stringify({iconClass:c,iconAnimateClass:m}))}else new toast({text:a.errorMsg})}}),util.ajax({url:"/updateImgData",type:"post",data:{imgId:h},success:function(e){200!==JSON.parse(e).status&&new toast({text:"绘图图片上传失败"})}}))}else util.ajax({url:"/addMatchData",type:"post",data:d,success:function(t){var a=JSON.parse(t);if(200===a.status){var n=dom.query("span",o);i-1==0?(dom.query("i",o).classList.add("notHave"),n.classList.add("notHave"),n.innerText=0):n.innerText=parseInt(n.innerText)-1,e.emit("userGiveProp",JSON.stringify({iconClass:c,iconAnimateClass:m}))}else new toast({text:a.errorMsg})}})})}else 500===a.status&&new toast({text:a.errorMsg})}})},uploadPaintImg:function(e,t){var a=util.dataURLtoBlob(t),o=new FormData;o.append("imgBlob",a),loadAni?loadAni.show():loadAni=new loadAnimate(pDom.showDraw),util.ajax({url:"/uploadPaintImg",type:"post",async:!1,data:o,contentType:!0,success:function(t){e.emit("getCurImgId",t)}})},emitNextUser:function(e){e.emit("showAnswer",meTimeData.keyWord),canvasUtil.canvasToPng(canvas,null,function(t){paintCom.uploadPaintImg(e,t)}),setTimeout(function(){dom.hide(pDom.showDraw),cache.remove("keyWord"),pDom.sendInput.removeAttribute("disabled"),e.emit("nextUser",meTimeData.curNum)},1e4)},animate:function(e,t){var a=document.createElement("div");a.classList.add(t);var o=document.createElement("i");o.classList.add("iconfont",e),dom.append(a,o),dom.append(document.body,a),a.addEventListener("animationend",function(){dom.remove(a)})},addWait:function(e){var t=dom.createByHTML('<div class="wait" data-time = "3"><p>3</p></div>');dom.append(e,t);var a=setInterval(function(){var e=parseInt(t.dataset.time);0===e&&(clearInterval(a),dom.remove(t)),t.innerHTML="<p>"+(e-1)+"</p>",t.dataset.time=e-1},1e3)}},reactComFun={show:function(){dom.show(pDom.paintMain),dom.hide(pDom.userList),dom.hide(pDom.ready),dom.hide(pDom.lock),dom.hide(pDom.sendInvate),pDom.keyWord.innerText="暂无提示",pDom.leftTime.innerText="",document.body.addEventListener("touchmove",reactComFun.mbPreventDefault)},hide:function(){dom.hide(pDom.paintMain),dom.show(pDom.userList),dom.show(pDom.ready),dom.hide(pDom.showDraw),dom.hide(pDom.drawUtil),pDom.lock.classList.remove("hide"),pDom.sendInvate.classList.remove("hide"),pDom.readyText.innerText="准备",document.body.removeEventListener("touchmove",reactComFun.mbPreventDefault)},mbPreventDefault:function(e){e&&e.preventDefault()},startGameTimer:function(e,t){(userTimer=util.countDown("/src/js/timerJs/gameTimer.js",e,t||function(){})).startWorker()}};function clientSocket(){var e=null,t=!1,a=null;return{initGameSocket:function(o,n){a=o,e=io.connect("/"+cache.get("serverName")),socketStatus.init(e),e.on("connect",function(){socketStatus.myLoading?socketStatus.myLoading.setText("房间连接成功"):socketStatus.myLoading=new loading({text:"房间连接成功"}),socketStatus.myLoading.hide();var a={roomId:o.roomId,userName:cache.get("userName"),email:cache.get("email"),isReady:t};e.emit("joinRoom",JSON.stringify(a)),"function"==typeof n&&n()}),e.on("clientPaint",function(e){(e=JSON.parse(e))&&canvasUtil.drawPts(canvas,ctx,e)}),e.on("erase",function(e,t,a,o){new Rect(e,t,a,o).clearOn(ctx)}),e.on("newUserAddRoom",function(e){reactEvent.updateUserList(e)}),e.on("ready",function(a){reactEvent.updateReady("ready",a,e),t=!0}),e.on("cancleReady",function(a){reactEvent.updateReady("cancleReady",a,e),t=!1}),e.on("gameStart",function(t){reactEvent.gameStart(e,t)}),e.on("gameRestart",function(t){reactEvent.gameRestart(),reactEvent.stopAll(e)}),e.on("gameEnd",function(t){reactEvent.gameEnd(e)}),e.on("isMeTime",function(t){reactEvent.isMeTime(e,JSON.parse(t))}),e.on("notMeTime",function(t){reactEvent.notMeTime(e)}),e.on("clearPaint",function(e){reactEvent.clearPaint()}),e.on("curGameData",function(e){reactEvent.curGameData(JSON.parse(e))}),e.on("message",function(e){reactEvent.getMessage(JSON.parse(e))}),e.on("updateScore",function(e){reactEvent.updateScore(JSON.parse(e))}),e.on("showAnswer",function(t){reactEvent.showAnswer(e,t)}),e.on("userAllAnswerRight",function(){reactEvent.userAllAnswerRight(e)}),e.on("startTimer",function(t){reactEvent.startTimer(e,JSON.parse(t))}),e.on("getCurImgId",function(e){reactEvent.setAnswerImgId(e)}),e.on("userGiveProp",function(e){reactEvent.showProp(e)}),e.on("addTime",function(e){reactEvent.addTime()}),e.on("changeWord",function(e){reactEvent.changeWord()})},closeSocket:function(){e.close(),e=null,t=!1,ctx.clearRect(0,0,canvas.width,canvas.height),a.hasInRoom=!1;var o=dom.queryAll(".msg");if(o)for(var n=0,i=o.length;n<i;n++)dom.remove(o[n])},getSocket:function(){return e}}}